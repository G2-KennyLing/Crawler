<!DOCTYPE html>
<html :class="{ 'theme-dark': dark }" x-data="data()" lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-svale=1.0" />
    <title>Tables - Van Linh</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="./assets/css/tailwind.output.css" />
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script src="./assets/js/init-alpine.js"></script>
</head>
<style>
     :root {
        --bg-opacity: 0.5 !important;
        --bg-color: red;
    }
    
    .cac {
        all: unset;
        width: 100%;
    }
    
    .disabled {
        display: none;
    }
    
    .loader {
        border-top-color: #3498db;
        -webkit-animation: spinner 1.5s linear infinite;
        animation: spinner 1.5s linear infinite;
    }
    
    @-webkit-keyframes spinner {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }
    
    @keyframes spinner {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
</style>

<body>
    <div class="flex h-screen bg-gray-50 dark:bg-gray-900" :class="{ 'overflow-hidden': isSideMenuOpen}">
        <div class="flex flex-col flex-1 w-full">
            <!--  -->
            <main class="h-full pb-16 overflow-y-auto">

                <div class="container grid px-6 mx-auto">
                    <div style="display: flex">
                        <h2 class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200">
                            Tables
                        </h2>
                        <button type="button" id="crawl" class=" btn btn-primary m-3 p-2" style="background-color: green; width: 150px; height: 50px; margin: 20px; padding: 5px;">Crawl</button>
                        <div id="output"></div>
                    </div>

                    <!-- With actions -->
                    <div class=" justify-between d-flex">
                        <h4 class="mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300">
                            Table URL Page
                        </h4>
                        <button type="button" id="addUrl" class="btn btn-primary m-3 p-2" style="background-color: lightblue;">Add URL Page</button>
                    </div>
                    <div id="inputAddUrl"></div>
                    <div class="w-full overflow-hidden rounded-lg shadow-xs">
                        <div class="w-full overflow-x-auto">
                            <table class="w-full whitespace-no-wrap table-bordered">
                                <thead>
                                    <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
                                        <th class="text-center" scope="col">#</th>
                                        <th class="text-center" scope="col">URL Page</th>
                                        <th class="text-center" scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800" id="urlPage">



                                </tbody>
                            </table>
                            <div id="btnSaveUrl"></div>
                        </div>
                        <div class=" justify-between d-flex">
                            <h4 class="mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300">
                                Table Proxies
                            </h4>
                            <button id="btnAddProxy" type="button" class="btn btn-primary m-3 p-2" style="background-color: lightblue;">Add Proxy</button>

                        </div>
                        <div id="inputAddProxy"></div>
                        <div class="w-full overflow-hidden rounded-lg shadow-xs">

                            <div class="w-full overflow-x-auto">
                                <table class="w-full whitespace-no-wrap table-bordered">
                                    <thead>
                                        <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
                                            <th class="text-center" scope="col">#</th>
                                            <th class="text-center" scope="col">Proxies</th>
                                            <th class="text-center" scope="col">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800" id="proxies">

                                </table>
                                <div id="btnSaveProxies"></div>
                            </div>
                            <div class=" justify-between d-flex">
                                <h4 class="mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300">
                                    Table User Agent
                                </h4>
                                <button id="btnAddUA" type="button" class="btn btn-primary m-3 p-2" style="background-color: lightblue;">Add User Agent</button>

                            </div>
                            <div id="inputAddUA"></div>
                            <div class="w-full overflow-hidden rounded-lg shadow-xs">

                                <div class="w-full overflow-x-auto">
                                    <table class="w-full whitespace-no-wrap table-bordered">
                                        <thead>
                                            <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
                                                <th class="text-center" scope="col">#</th>
                                                <th class="text-center" scope="col">User Agent</th>
                                                <th class="text-center" scope="col">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800" id="userAgent">

                                    </table>
                                    <div id="btnSaveUA"></div>
                                </div>
                            </div>
                        </div>
            </main>
            </div>
            </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ==" crossorigin="anonymous"></script>
<script>
    const btnCrawl = document.getElementById("crawl");
    const output = document.getElementById("output");
    const renderRow = (value, index, elem, axi, classs) => {
        return `<tr class="${classs} text-gray-700 dark:text-gray-400">
                <td class="px-4 py-3">
                    <div <p class="indexUrl">${index + 1}</p>
                    </div>
                </td>
                <td class="px-4 py-3">
                    <div class=" items-center text-sm">
                        <div id="url-${index}">
                            <input class="font-semibold cac" value='${value}' disabled="true" />
                        </div>
                    </div>
                </td>

                <td class="px-4 py-3">
                    <div id="actionUrl${index}" class="btnE items-center space-x-4 text-sm flex justify-center">
                        <button onclick="edit(this,${index}, ${elem}, '${axi}', '${classs}')" class="tdEdit flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-purple-600 rounded-lg dark:text-gray-400 focus:outline-none focus:shadow-outline-gray" aria-label="Edit">
                                    <svg
                                  class="w-5 h-5"
                                  aria-hidden="true"
                                  fill="currentColor"
                                  viewBox="0 0 20 20"
                                >
                                  <path
                                    d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                                  ></path>
                                </svg>
                              </button>
                        <button onclick="deleteVal(${index}, ${elem},'${axi}' )" class="flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-purple-600 rounded-lg dark:text-gray-400 focus:outline-none focus:shadow-outline-gray" aria-label="Delete">
                                <svg
                                  class="w-5 h-5"
                                  aria-hidden="true"
                                  fill="currentColor"
                                  viewBox="0 0 20 20"
                                >
                                  <path
                                    fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd"
                                  ></path>
                                </svg>
                              </button>
                              <button class="disabled tdEdit flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-purple-600 rounded-lg dark:text-gray-400 focus:outline-none focus:shadow-outline-gray" aria-label="Edit">
                                 Save
                              </button>
                    </div>
                </td>
            </tr>`
    }
    let arrUrl = [];
    axios.get("http://localhost:3000/getListUrl").then(({
        data
    }) => {
        const tbody = document.getElementById("urlPage");
        const elem = 'urlPage';
        const axi = 'Url';
        if (data.data) {
            tbody.innerHTML = "";
            arrUrl = [...data.data];
            data.data.forEach((url, i, data) => {
                tbody.innerHTML += renderRow(url, i, elem, axi, "claUrl");
            })
        }
    })
    let arrProxies = [];
    axios.get("http://localhost:3000/getListProxies").then(({
        data
    }) => {
        const tbody = document.getElementById("proxies");
        if (data.data) {
            tbody.innerHTML = "";
            arrProxies = [...data.data];
            data.data.forEach((proxy, i, data) => {
                tbody.innerHTML += renderRow(proxy, i, 'proxies', 'Proxies', 'claProxies');
                i++
            })
        }
    })
    let arrUA = [];
    axios.get("http://localhost:3000/getListUserAgent").then(({
        data
    }) => {
        const tbody = document.getElementById("userAgent");
        if (data.data) {
            tbody.innerHTML = "";
            arrUA = [...data.data];
            arrUA.forEach((userA, i, data) => {
                tbody.innerHTML += renderRow(userA, i, 'userAgent', 'UserAgent', 'claUA');
            })
        }
    })
    btnCrawl.addEventListener("click", () => {
        output.innerHTML = `<div wire:loading class="fixed top-0 left-0 right-0 bottom-0 w-full h-screen z-50 overflow-hidden bg-gray-700 opacity-75 flex flex-col items-center justify-center">
	<div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
	<h2 class="text-center text-white text-xl font-semibold" style="color: blue">Loading...</h2>
	<p class="w-1/3 text-center text-white" style="color: blue">This may take a few seconds, please don't close this page.</p>
</div> <button>hey</button>`;
        axios.post("http://localhost:3000/crawler").then(({
            data
        }) => {
            const a = document.createElement("a");
            output.innerHTML = "";
            const href = 'data:attachment/csv;charset=utf-8,' + encodeURI(data);
            a.href = href;
            a.target = '_blank';
            a.download = 'newmoon_import_template.csv'
            a.click();
            a.classList.add("btn");
            a.classList.add("btn-primary");
            output.innerHTML = `<div x-data="{isShow: true}">
  <div x-show="isShow" class="absolute top-0 right-0 m-3 w-2/3 md:w-1/3" x-transition:enter="transition transform ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-1" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition transform ease-in duration-300" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 translate-y-1">
    <div class="bg-white border-gray-300 border p-3 flex items-start shadow-lg rounded-md space-x-2">
      <svg class="flex-shrink-0 h-6 w-6 text-green-400" stroke="currentColor" viewBox="0 0 20 20">
        <path stroke-width="1" d="M10.219,1.688c-4.471,0-8.094,3.623-8.094,8.094s3.623,8.094,8.094,8.094s8.094-3.623,8.094-8.094S14.689,1.688,10.219,1.688 M10.219,17.022c-3.994,0-7.242-3.247-7.242-7.241c0-3.994,3.248-7.242,7.242-7.242c3.994,0,7.241,3.248,7.241,7.242C17.46,13.775,14.213,17.022,10.219,17.022 M15.099,7.03c-0.167-0.167-0.438-0.167-0.604,0.002L9.062,12.48l-2.269-2.277c-0.166-0.167-0.437-0.167-0.603,0c-0.166,0.166-0.168,0.437-0.002,0.603l2.573,2.578c0.079,0.08,0.188,0.125,0.3,0.125s0.222-0.045,0.303-0.125l5.736-5.751C15.268,7.466,15.265,7.196,15.099,7.03"></path>
      </svg>
      <div class="flex-1 space-y-1">
        <p class="text-base leading-6 font-medium text-gray-700">Successfully saved!</p>
        <p class="text-sm leading-5 text-gray-600">Anyone with a link can now view this file</p>
      </div>
      <svg class="flex-shrink-0 h-5 w-5 text-gray-400 cursor-pointer" x-on:click="isShow = false" stroke="currentColor" viewBox="0 0 20 20">
        <path stroke-width="1.2" d="M15.898,4.045c-0.271-0.272-0.713-0.272-0.986,0l-4.71,4.711L5.493,4.045c-0.272-0.272-0.714-0.272-0.986,0s-0.272,0.714,0,0.986l4.709,4.711l-4.71,4.711c-0.272,0.271-0.272,0.713,0,0.986c0.136,0.136,0.314,0.203,0.492,0.203c0.179,0,0.357-0.067,0.493-0.203l4.711-4.711l4.71,4.711c0.137,0.136,0.314,0.203,0.494,0.203c0.178,0,0.355-0.067,0.492-0.203c0.273-0.273,0.273-0.715,0-0.986l-4.711-4.711l4.711-4.711C16.172,4.759,16.172,4.317,15.898,4.045z"></path>
      </svg>
    </div>
  </div>
</div>`;
        })
    });
    const btnAddUrl = document.getElementById("addUrl");
    btnAddUrl.addEventListener("click", () => {
        const inputAddUrl = document.getElementById("inputAddUrl");
        inputAddUrl.innerHTML = `<div id="inputAdd" style="display: block; margin: 5px; padding: 5px; width: 150px"> <textarea id="input" style="width:600px; height:100px;" > </textarea> 
            <button id = "btnAdd" type="button" class="btn btn-primary m-3 p-2" style="background-color: lightblue;  margin: 5px;">Add</button> </div>`
        const btnAdd = document.getElementById("btnAdd");
        btnAdd.addEventListener("click", () => {
            const url = document.getElementById("input").value.split('\n');
            axios.post("http://localhost:3000/addUrl", {
                url
            }).then(({
                data
            }) => {
                document.getElementById("input").value = "";
                location.reload();

            })
        })
    })
    const btnAddProxy = document.getElementById("btnAddProxy");
    btnAddProxy.addEventListener("click", () => {
        const inputAdd = document.getElementById("inputAddProxy");
        inputAdd.innerHTML = `<div id="inputAdd" style="display: block; margin: 5px; padding: 5px; width: 150px"> <textarea id="input" style="width:600px; height:100px;" > </textarea> 
            <button id = "btnAdd" type="button" class="btn btn-primary m-3 p-2" style="background-color: lightblue;  margin: 5px;">Add</button> </div>`
        const btnAdd = document.getElementById("btnAdd");
        btnAdd.addEventListener("click", () => {
            const proxy = document.getElementById("input").value.split('\n');
            axios.post("http://localhost:3000/addProxy", {
                proxy
            }).then(({
                data
            }) => {
                document.getElementById("input").value = "";
                location.reload();

            })
        })
    })
    const btnAddUA = document.getElementById("btnAddUA");
    btnAddUA.addEventListener("click", () => {
        const inputAdd = document.getElementById("inputAddUA");
        inputAdd.innerHTML = `<div id="inputAdd" style="display: block; margin: 5px; padding: 5px; width: 150px"><textarea id="input" style="width:600px; height:100px;" > </textarea> 
            <button id = "btnAdd" type="button" class="btn btn-primary m-3 p-2" style="background-color: lightblue;  margin: 5px;">Add</button> </div>`
        const btnAdd = document.getElementById("btnAdd");
        btnAdd.addEventListener("click", () => {
            const userAgent = document.getElementById("input").value.split('\n');
            axios.post("http://localhost:3000/addUserAgent", {
                userAgent
            }).then(({
                data
            }) => {

                document.getElementById("input").value = "";
                location.reload();

            })
        })
    })
    const edit = (btn, index, elem, axi, classs) => {
        const urlEl = document.querySelector(`tr.${classs} > td:nth-child(2) > div > #url-${index} > .cac`);
        urlEl.disabled = false;
        urlEl.focus();
        urlEl.style.background = "#111"
        const btnSave = document.querySelector(`tr.${classs} > td:nth-child(3) > #actionUrl${index} > button:last-child`);
        btnSave.classList.remove("disabled");
        btnSave.addEventListener("click", () => {
            btnSave.classList.add("disabled");
            urlEl.disabled = true;
            urlEl.style.background = "transparent";
            let arr = [];
            if (axi == "Url") arr = arrUrl;
            else if (axi == "Proxies") arr = arrProxies;
            else if (axi == "UserAgent") arr = arrUA;
            arr = arr.map((url, i) => {
                if (i === index) {
                    return urlEl.value;
                }
                return url;
            })
            const data = arr;
            console.log(data)
            axios.put("http://localhost:3000/update" + axi, {
                data
            }).then(({
                data
            }) => {
                const tbody = document.getElementById(elem);
                if (data.data) {
                    tbody.innerHTML = "";
                    arrUrl = [...data.data];
                    data.data.forEach((url, i, data) => {
                        tbody.innerHTML += renderRow(url, i, data);
                    })
                }
            })
        })
    }
    const deleteVal = (index, elem, axi) => {
        let arr = [];
        if (axi == "Url") arr = arrUrl;
        else if (axi == "Proxies") arr = arrProxies;
        else if (axi == "UserAgent") arr = arrUA;
        arr = arr.filter((val, i) => {
            return index != i
        })
        const data = arr;
        axios.put("http://localhost:3000/update" + axi, {
            data
        }).then(({
            data
        }) => {
            const tbody = document.getElementById(elem);
            if (data.data) {
                tbody.innerHTML = "";
                arrUrl = [...data.data];
                data.data.forEach((val, i, data) => {
                    tbody.innerHTML += renderRow(val, i, data);
                })

            }
        })
        location.reload();
    }
</script>

</html>